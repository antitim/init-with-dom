function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;t.length>r;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}var nodeEach=function(e,t){for(var r=0;e.length>r;r++)t(e[r],r)},camelCase=function(e){return e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})},getAttr=function(e){for(var t={data:{}},r=0;e.attributes.length>r;r++){var n=e.attributes[r].name,i=e.attributes[r].textContent;"data"===n.slice(0,4)?(n=n.slice(5),n=camelCase(n),t.data[n]=i):t[n=camelCase(n)]=i}return t},NodesHandlers=function e(){var t=this;_classCallCheck(this,e),_defineProperty(this,"executeHandler",function(e){var r=t.handlers[e],n=t.nodes[e];n&&r&&nodeEach(n,function(e){return t.init(e,r)})}),_defineProperty(this,"init",function(e,r){if(!e.classList.contains("js_inited")){var n=getAttr(e),i=!0,o=!1,a=void 0;try{for(var d,s=t.middleware[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){n=(0,d.value)(e,n)}}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}r.call(e,n),e.classList.add("js_inited")}}),_defineProperty(this,"addNode",function(e){if(e.getAttribute){var r=e.getAttribute("data-js");r&&(e.classList.add("js"),t.nodes[r]||(t.nodes[r]=[]),t.nodes[r].push(e),t.executeHandler(r))}}),_defineProperty(this,"removedUnusedNode",function(){for(var e=Object.keys(t.nodes),r=0;e.length>r;r++){var n=e[r];t.nodes[n]=t.nodes[n].filter(function(e){return e.isConnected})}}),_defineProperty(this,"addHandler",function(e,r){t.handlers[e]=r,t.executeHandler(e)}),_defineProperty(this,"replaceHandler",function(e,r){t.handlers[e]=r}),_defineProperty(this,"removeHandler",function(e){t.handlers[e]=null}),_defineProperty(this,"removeAllHandlers",function(){t.handlers={}}),this.nodes={},this.handlers={},this.middleware=[]},dispatchEvent=function(e,t,r){var n;try{n=new CustomEvent(t,{detail:r})}catch(e){(n=document.createEvent("CustomEvent")).initCustomEvent(t,!1,!1,r)}e.dispatchEvent(n)},getObserver=function(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver},Iwd=function(e){function t(e){var r;return _classCallCheck(this,t),_defineProperty(_assertThisInitialized(_assertThisInitialized(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e)))),"mutationCallback",function(e){e.forEach(function(e){"childList"===e.type&&nodeEach(e.addedNodes,function(e){r.addNode(e),e.querySelectorAll&&nodeEach(e.querySelectorAll("[data-js]"),r.addNode)});"attributes"===e.type&&dispatchEvent(e.target,"iwdUpdate",{attribute:e.attributeName})})}),nodeEach(document.querySelectorAll("[data-js]"),r.addNode),r.Observer=getObserver(),r.attachEvent(),r}return _inherits(t,NodesHandlers),_createClass(t,[{key:"attachEvent",value:function(){var e=this;this.Observer?new this.Observer(this.mutationCallback).observe(document.body,{childList:!0,attributes:!0,subtree:!0}):(document.addEventListener("DOMNodeInserted",function(t){t.target.constructor!==NodeList?e.addNode(t.target):nodeEach(t.target,e.addNode)},!1),document.addEventListener("DOMAttrModified",function(e){dispatchEvent(e.target,"iwdUpdate",{attribute:e.attrName})},!1))}}]),t}(),iwd=new Iwd,index={add:iwd.addHandler,replace:iwd.replaceHandler,remove:iwd.removeHandler,removeAll:iwd.removeAllHandlers,middleware:iwd.middleware};export default index;
