"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}var nodeEach=function(e,t){for(var n=0;e.length>n;n++)t(e[n],n)},camelCase=function(e){return e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})},getAttr=function(e){for(var t={data:{}},n=0;e.attributes.length>n;n++){var r=e.attributes[n].name,i=e.attributes[n].textContent;"data"===r.slice(0,4)?(r=r.slice(5),r=camelCase(r),t.data[r]=i):t[r=camelCase(r)]=i}return t},NodesHandlers=function e(){var t=this;_classCallCheck(this,e),_defineProperty(this,"executeHandler",function(e){var n=t.handlers[e],r=t.nodes[e];r&&n&&nodeEach(r,function(e){return t.init(e,n)})}),_defineProperty(this,"init",function(e,t){e.classList.contains("js_inited")||(t.call(e,getAttr(e)),e.classList.add("js_inited"))}),_defineProperty(this,"addNode",function(e){if(e.getAttribute){var n=e.getAttribute("data-js");n&&(e.classList.add("js"),t.nodes[n]||(t.nodes[n]=[]),t.nodes[n].push(e),t.executeHandler(n))}}),_defineProperty(this,"removedUnusedNode",function(){for(var e=Object.keys(t.nodes),n=0;e.length>n;n++){var r=e[n];t.nodes[r]=t.nodes[r].filter(function(e){return e.isConnected})}}),_defineProperty(this,"addHandler",function(e,n){t.handlers[e]=n,t.executeHandler(e)}),_defineProperty(this,"replaceHandler",function(e,n){t.handlers[e]=n}),_defineProperty(this,"removeHandler",function(e){t.handlers[e]=null}),_defineProperty(this,"removeAllHandlers",function(){t.handlers={}}),this.nodes={},this.handlers={}},dispatchEvent=function(e,t,n){var r;try{r=new CustomEvent(t,{detail:n})}catch(e){(r=document.createEvent("CustomEvent")).initCustomEvent(t,!1,!1,n)}e.dispatchEvent(r)},getObserver=function(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver},Iwd=function(e){function t(e){var n;return _classCallCheck(this,t),_defineProperty(_assertThisInitialized(_assertThisInitialized(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e)))),"mutationCallback",function(e){e.forEach(function(e){"childList"===e.type&&nodeEach(e.addedNodes,function(e){n.addNode(e),e.querySelectorAll&&nodeEach(e.querySelectorAll("[data-js]"),n.addNode)});"attributes"===e.type&&dispatchEvent(e.target,"iwdUpdate",{attribute:e.attributeName})})}),nodeEach(document.querySelectorAll("[data-js]"),n.addNode),n.Observer=getObserver(),n.attachEvent(),n}return _inherits(t,NodesHandlers),_createClass(t,[{key:"attachEvent",value:function(){var e=this;this.Observer?new this.Observer(this.mutationCallback).observe(document.body,{childList:!0,attributes:!0,subtree:!0}):(document.addEventListener("DOMNodeInserted",function(t){t.target.constructor!==NodeList?e.addNode(t.target):nodeEach(t.target,e.addNode)},!1),document.addEventListener("DOMAttrModified",function(e){dispatchEvent(e.target,"iwdUpdate",{attribute:e.attrName})},!1))}}]),t}(),iwd=new Iwd,index={add:iwd.addHandler,replace:iwd.replaceHandler,remove:iwd.removeHandler,removeAll:iwd.removeAllHandlers};module.exports=index;
